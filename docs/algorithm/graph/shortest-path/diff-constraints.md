---
title: 差分约束
createTime: 2026/02/10 21:49:25
permalink: /algorithm/graph/shortest-path/diff-constraints/
---

## 简介
如果一个题目给定了**多个不等式关系**，并且需要求最大/小值，那么大概率需要用到差分约束。  
具体的来讲，我们可以将这些不等式关系转换为 $x_i \leq x_j+w_k$，根据图论中的三角形不等式，只需要指定一些值的大小就可以求出可行解，也就是说，一般的不等式只有**相对关系**。  
若需要让 $x_i\leq x_j+w_k$，只需要连一条 $j\rightarrow i$ 的边，边权为 $w_k$，由于 $x_i,x_j,w_k \in \mathbb{Z}$，我们可以将小于和大于转换为 $-1$ 和 $+1$。  
::: warning
在这其中，必须要保证**所有点是可达的**，如果存在不可达，则不满足三角形不等式。  
一般可以使用超级源点处理，向所有点连一条边。  
:::
还有一个问题，**求最小值要用最长路**，**求最大值要用最短路**。  
为什么呢？以求最小值为例，还记得我们固定的那个点吗？在更新中，如果使用最短路大概率会出现负数，而最长路则能保证最开始的点一定是最小值。  
也可以理解为，我们要求的是 $x_1\geq x_2+w_2\geq x_3+w_3\geq \cdots\geq x_n+w_n$，而 $x_1$ 的下界则是所有约束条件中的上界。  

~~处理完上述问题，还有一个问题~~  
如果图中存在负环，证明什么？  
这种情况下，令环上的一个点为 $x_1$，剩下一直到 $x_i$，编号小的点向编号大的点连边的边权为 $w_1\sim w_i$，我们一定可以推出 $x_1\leq x_1+\sum_{w_1}^{w_i}$，而 $\sum_{w_1}^{w_i}<0$，所以三角形不等式不成立，也就是**图中存在负环时表示不等式组无解**。  

## 例题
### Acwing 1169. 糖果 {#acwing-1169}
[题目传送门](https://www.acwing.com/problem/content/1171/)  
非常板子的题目，跟上面讲的一样。

### Acwing 362. 区间 {#acwing-362}
[题目传送门](https://www.acwing.com/problem/content/364/)  
题目的范围是 $1\sim 50000$，但我们可以统一加一个 $1$，变成 $1\sim 50001$。  
然后我们需要进行一个转换：设 $s_i$ 表示从 $1\sim i$ 中选中的数的个数。  
容易发现，我们有以下几个约束条件：
*   $s_i\geq s_{i-1}$
*   $s_{i-1}\geq s_i-1$
*   对于一个约束条件 $[a,b]$ 和 $c$，$s_b\geq s_{a-1} + c$

要求最小值，所以跑最长路即可。  