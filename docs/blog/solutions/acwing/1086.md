---
title: 'Acwing 1086. 恨7不成妻'
createTime: 2025/12/03 19:12:28
permalink: /blog/6ky2ofdz/
draft: true
tags:
    - 数位DP
    - 数学
---

## _Intro_
[题目传送门](https://www.acwing.com/problem/content/description/1088/)  
给定闭区间 $[L,R]$，求这个区间内所有满足以下条件的数的平方和：  
* 整数中每一位都不是 $7$。
* 整数中每一位加起来的和不是 $7$ 的整数倍。
* 整数不是 $7$ 的整数倍。

## _Solution_
容易发现，我们为了快速处理长度为 $i$，开头为 $j$ 的所有满足条件的数的平方和，需要将每一位的和与这个整数放进状态里。  
所以我们定义状态为：$f_{i,j,a,b}$ 表示共有 $i$ 位，开头为 $j$，这个数模 $7$ 为 $a$，各位数字之和模 $7$ 余数为 $b$。  
这样的话我们可以从 $f_{i-1,k,a-j\times 10^{i-1},b-j }$ 转移上来。  
但我们要求的是平方和，怎么办？

::: important
对于一个形如 $\overline{j A_i}(i\in [1,t])$ 的 $i$ 位数，我们可以将其转换一下，举个例子：  
$$
\begin{aligned}
&(\overline{j A_1})^2+(\overline{j A_2})^2+\dots+(\overline{j A_t})^2 \\
&= (j\times 10^{i-1})^2\times t+2\times j\times 10^{i-1}\times (A_1+A_2+\dots+A_t) + A_1^2+A_2^2+\dots+A_t^2 \\
\end{aligned}
$$
所以我们只需要知道 $t$ 和 $\sum A_i$ 和 $\sum A_i^2$ 就能快速得到下一层的方案数，同理我们来看看怎么得到 $\overline{j A_1}+\overline{j A_2}+\dots+\overline{j A_t}$。
$$
\begin{aligned}
&\overline{j A_1}+\overline{j A_2}+\dots+\overline{j A_t} \\
&= j\times 10^{i-1}\times t + (A_1+A_2+\dots+A_t)
\end{aligned}
$$
:::

## _Code_